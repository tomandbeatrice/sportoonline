import{d as T,r as y,c as z,o as F,e as d,f as i,g as e,t as o,F as m,i as n,w as l,z as r,j as u,k as g,M as q,n as K,ah as D}from"./index-BGyiXXhD.js";import{_ as v,a as h,b,c as k,d as w,e as V}from"./Alert.vue_vue_type_script_setup_true_lang-BrAK_WXF.js";const j={class:"bg-slate-50 px-4 py-10 md:px-8"},G={key:0,class:"flex h-[60vh] flex-col items-center justify-center gap-3 text-slate-500"},R={key:1,class:"rounded-3xl border border-orange-100 bg-white px-6 py-4 text-center text-sm text-orange-700"},U={class:"grid gap-6 lg:grid-cols-[1.4fr_0.8fr]"},J={class:"text-xs uppercase tracking-[0.3em] text-white/60"},W={class:"text-4xl font-semibold"},Y={class:"text-sm text-white/70"},I={class:"mt-8 grid gap-6 lg:grid-cols-3"},O={class:"overflow-x-auto"},Q={class:"min-w-full text-left text-sm"},X={class:"px-4 py-4"},Z={class:"text-sm font-semibold text-slate-900"},tt={class:"text-xs text-slate-400"},et={class:"px-4 py-4 text-sm text-slate-500"},at={class:"px-4 py-4 text-sm text-slate-500"},st={class:"px-4 py-4 text-sm text-slate-500"},lt={class:"px-4 py-4 text-sm text-slate-500"},rt={class:"px-4 py-4"},nt={class:"flex items-center justify-between"},ot={class:"text-sm font-semibold text-slate-900"},it={class:"text-xs text-slate-400"},dt={class:"text-xs uppercase tracking-[0.3em] text-slate-400"},ut={class:"mt-2 text-sm text-slate-500"},mt=T({__name:"ExportFileList",setup(pt){const c=y([]),B=y([]),S=y(!0),f=y(null),x=z(()=>({lastDay:c.value.filter(t=>t.status==="Hazır").length,inProgress:c.value.filter(t=>t.status==="Hazırlanıyor").length})),$=z(()=>[{label:"Toplam Export",value:c.value.length.toString().padStart(2,"0"),hint:"Bu hafta oluşturulan dosya"},{label:"Hazır Dosya",value:x.value.lastDay.toString().padStart(2,"0"),hint:"Linki paylaşılabilir"},{label:"Kuyruktaki İş",value:x.value.inProgress.toString().padStart(2,"0"),hint:"Hazırlanması bekleniyor"}]),M=z(()=>{const t=x.value.inProgress?{id:"queue",title:`Kuyrukta ${x.value.inProgress} iş var`,description:"Worker kuyruğunu boşaltmak için ek kapasite açabilirsin.",variant:"orange"}:{id:"queue",title:"Kuyruk boş",description:"Tüm exportlar tamamlandı, yeni job planlayabilirsin.",variant:"emerald"};return[{id:"storage",title:`${c.value.length} dosya arşivde`,description:"Export dosyaları 30 gün boyunca saklanır.",variant:"default"},t]});function A(t){return t==="Hazır"?"rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-700":"rounded-full bg-orange-100 px-3 py-1 text-xs font-semibold text-orange-700"}function N(t){const a=(t||"").toLowerCase();return["completed","ready","success","hazır"].includes(a)?"Hazır":"Hazırlanıyor"}function E(t){return t?new Date(t).toLocaleString("tr-TR",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}):"—"}function C(t){if(t==null)return"—";const a=typeof t=="string"?Number(t):t;if(Number.isNaN(a))return typeof t=="string"?t:"—";if(a===0)return"0 B";const s=["B","KB","MB","GB"],_=Math.min(s.length-1,Math.floor(Math.log(a)/Math.log(1024))),p=a/Math.pow(1024,_);return`${p.toFixed(p>=10?0:1)} ${s[_]}`}function H(t){const a=t.file_name||t.filename||t.name||"export.csv",s=a.split(".").pop()?.toUpperCase()||"CSV",_=t.export_type||t.description||t.action||"Segment exportu",p=t.file_size??t.size??t.payload_size;return{id:t.id??a,name:a,description:_,format:s,segment:t.segment||t.vendor_name||t.vendor||"Genel",size:typeof p=="string"&&p.includes("B")?p:C(p),date:E(t.exported_at||t.created_at||t.updated_at),status:N(t.status)}}function L(t){return{id:t.id??t.filename??t.segment,title:t.segment||t.filename||"Segment Exportu",segment:t.vendor||t.vendor_name||"Genel kanal",frequency:t.schedule||"Tek seferlik",window:E(t.created_at)}}async function P(){S.value=!0,f.value=null;try{const[t,a]=await Promise.all([D.get("/exports/logs"),D.get("/exports/scheduled")]);c.value=Array.isArray(t.data)?t.data.map(H):[],B.value=Array.isArray(a.data)?a.data.map(L):[]}catch(t){console.error("Export verileri yüklenemedi:",t),f.value="Export logları alınamadı. Lütfen daha sonra tekrar deneyin."}finally{S.value=!1}}return F(P),(t,a)=>(i(),d("div",j,[S.value?(i(),d("div",G,[...a[0]||(a[0]=[e("span",{class:"h-10 w-10 animate-spin rounded-full border-2 border-slate-200 border-t-slate-500"},null,-1),e("p",null,"Export verileri yükleniyor...",-1)])])):f.value?(i(),d("div",R,o(f.value),1)):(i(),d(m,{key:2},[e("section",U,[n(r(w),{class:"bg-gradient-to-r from-slate-900 via-indigo-900 to-violet-900 text-white"},{default:l(()=>[n(r(v),{class:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between"},{default:l(()=>[e("div",null,[n(r(h),{class:"text-3xl"},{default:l(()=>[...a[1]||(a[1]=[u("Dışa Aktarım Akışı",-1)])]),_:1}),n(r(b),{class:"text-white/70"},{default:l(()=>[u(" Son 24 saatte "+o(x.value.lastDay)+" dosya üretildi. Kuyruktaki job sayısı "+o(x.value.inProgress)+". ",1)]),_:1})]),a[2]||(a[2]=e("button",{class:"rounded-2xl bg-white px-5 py-2 text-sm font-semibold text-slate-900 shadow-lg shadow-slate-900/40 transition hover:-translate-y-[2px]"}," Yeni Segment Exportu ",-1))]),_:1}),n(r(k),{class:"grid gap-6 md:grid-cols-3"},{default:l(()=>[(i(!0),d(m,null,g($.value,s=>(i(),d("div",{key:s.label,class:"space-y-2"},[e("p",J,o(s.label),1),e("p",W,o(s.value),1),e("p",Y,o(s.hint),1)]))),128))]),_:1})]),_:1}),n(r(w),null,{default:l(()=>[n(r(v),null,{default:l(()=>[n(r(h),null,{default:l(()=>[...a[3]||(a[3]=[u("Export Sağlığı",-1)])]),_:1}),n(r(b),null,{default:l(()=>[...a[4]||(a[4]=[u("Servis kuyrukları ve uyarılar",-1)])]),_:1})]),_:1}),n(r(k),{class:"space-y-4"},{default:l(()=>[(i(!0),d(m,null,g(M.value,s=>(i(),q(r(V),{key:s.id,title:s.title,variant:s.variant},{default:l(()=>[u(o(s.description),1)]),_:2},1032,["title","variant"]))),128))]),_:1})]),_:1})]),e("section",I,[n(r(w),{class:"lg:col-span-2"},{default:l(()=>[n(r(v),null,{default:l(()=>[n(r(h),null,{default:l(()=>[...a[5]||(a[5]=[u("Son Exportlar",-1)])]),_:1}),n(r(b),null,{default:l(()=>[...a[6]||(a[6]=[u("Dosyaları indir veya bağlantıyı paylaş.",-1)])]),_:1})]),_:1}),n(r(k),null,{default:l(()=>[e("div",O,[e("table",Q,[a[7]||(a[7]=e("thead",null,[e("tr",{class:"text-xs uppercase tracking-[0.3em] text-slate-400"},[e("th",{class:"px-4 py-3"},"Dosya"),e("th",{class:"px-4 py-3"},"Format"),e("th",{class:"px-4 py-3"},"Segment"),e("th",{class:"px-4 py-3"},"Boyut"),e("th",{class:"px-4 py-3"},"Tarih"),e("th",{class:"px-4 py-3"},"Durum")])],-1)),e("tbody",null,[(i(!0),d(m,null,g(c.value,s=>(i(),d("tr",{key:s.id,class:"border-t border-slate-100"},[e("td",X,[e("p",Z,o(s.name),1),e("p",tt,o(s.description),1)]),e("td",et,o(s.format.toUpperCase()),1),e("td",at,o(s.segment),1),e("td",st,o(s.size),1),e("td",lt,o(s.date),1),e("td",rt,[e("span",{class:K(A(s.status))},o(s.status),3)])]))),128))])])])]),_:1})]),_:1}),n(r(w),null,{default:l(()=>[n(r(v),null,{default:l(()=>[n(r(h),null,{default:l(()=>[...a[8]||(a[8]=[u("Planlı Exportlar",-1)])]),_:1}),n(r(b),null,{default:l(()=>[...a[9]||(a[9]=[u("Önümüzdeki job takvimi",-1)])]),_:1})]),_:1}),n(r(k),{class:"space-y-4"},{default:l(()=>[(i(!0),d(m,null,g(B.value,s=>(i(),d("div",{key:s.id,class:"rounded-2xl border border-slate-100 bg-white p-4"},[e("div",nt,[e("div",null,[e("p",ot,o(s.title),1),e("p",it,o(s.segment),1)]),e("span",dt,o(s.frequency),1)]),e("p",ut,o(s.window),1)]))),128))]),_:1})]),_:1})])],64))]))}});export{mt as default};
