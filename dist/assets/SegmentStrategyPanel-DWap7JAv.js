import{r as n,o as k,e as a,f as l,g as s,h as y,i as S,j as N,t as u,F as p,k as f,D as I}from"./index-D2hY-dD-.js";import L from"./SegmentAccuracyBreakdown-BGmhiGls.js";import w from"./SegmentAccuracyChart-JjJuJi0o.js";import"./auto-BxYDYnC4.js";import"./chart-DUPVkyAx.js";const J=["disabled"],O={key:0},H={key:1},j={key:0},b={key:1},z={__name:"SegmentStrategyPanel",setup(x){const c=n(null),m=n("Yükleniyor..."),i=n([]),v=n(null),g=n(!1);async function _(){g.value=!0;try{const t=await I.post("/api/admin/refresh-campaign-strategy");c.value=t.data.weights,v.value=t.data.suggestion;const e=new Date().toLocaleString("tr-TR");m.value=e,h(e,t.data.weights);const r=JSON.parse(localStorage.getItem("accuracyLog")||"{}");r[e]=t.data.accuracy_percent,localStorage.setItem("accuracyLog",JSON.stringify(r))}catch(t){console.error("Strateji güncellemesi başarısız:",t)}finally{g.value=!1}}function h(t,e){localStorage.setItem("lastStrategyUpdate",t);const r=JSON.parse(localStorage.getItem("strategyHistory")||"[]"),o=[t,...r].slice(0,10);localStorage.setItem("strategyHistory",JSON.stringify(o)),i.value=o;const d=JSON.parse(localStorage.getItem("weightsLog")||"{}");d[t]=e,localStorage.setItem("weightsLog",JSON.stringify(d))}return k(()=>{m.value=localStorage.getItem("lastStrategyUpdate")||"Henüz güncellenmedi",i.value=JSON.parse(localStorage.getItem("strategyHistory")||"[]")}),(t,e)=>(l(),a("div",null,[e[3]||(e[3]=s("h2",null,"Segment Strateji Durumu",-1)),s("p",null,[e[0]||(e[0]=N("Son strateji güncellemesi: ",-1)),s("strong",null,u(m.value),1)]),s("button",{onClick:_,disabled:g.value},[g.value?(l(),a("span",O,"Güncelleniyor...")):(l(),a("span",H,"Stratejiyi Güncelle"))],8,J),c.value?(l(),a("div",j,[e[1]||(e[1]=s("h3",null,"Segment Ağırlıkları",-1)),s("ul",null,[(l(!0),a(p,null,f(c.value,(r,o)=>(l(),a("li",{key:o},u(o)+": "+u(r),1))),128))])])):y("",!0),S(L),S(w),i.value.length?(l(),a("div",b,[e[2]||(e[2]=s("h3",null,"Güncelleme Geçmişi",-1)),s("ul",null,[(l(!0),a(p,null,f(i.value,(r,o)=>(l(),a("li",{key:o},u(r),1))),128))])])):y("",!0)]))}};export{z as default};
