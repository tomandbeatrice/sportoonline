namespace App\Services;

use App\Models\Order;
use Iyzipay\Model\Payment;
use Iyzipay\Request\CreatePaymentRequest;

class PaymentService
{
    public function charge(Order $order, array $cardInfo)
    {
        $request = new CreatePaymentRequest();
        $request->setLocale("tr");
        $request->setConversationId((string) $order->id);
        $request->setPrice($order->total);
        $request->setPaidPrice($order->total);
        $request->setCurrency("TRY");
        $request->setInstallment(1);
        $request->setPaymentChannel("WEB");
        $request->setPaymentGroup("PRODUCT");

        // Kart bilgileri, buyer, basketItems vs. burada tanımlanır

        $payment = Payment::create($request, config('iyzico.options'));

        return $payment->getStatus() === 'success';
    }
}